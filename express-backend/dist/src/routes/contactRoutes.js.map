{"version":3,"sources":["../../../src/routes/contactRoutes.ts"],"sourcesContent":["import { Router } from 'express';\r\nimport { sendEmail } from '../services/emailService.js';\r\nimport fetch from 'node-fetch';\r\nimport { RecaptchaResponse } from '../types/recaptchaResponse.js';\r\n\r\nconst router = Router();\r\n\r\n// contact prefix set in server.ts\r\nrouter.post('/', async (req, res) => {\r\n\tconst { recaptchaResponse, name, email, phoneNumber, companyUrl, message } = req.body;\r\n\r\n\t// Verify recaptchaResponse with google's api\r\n\tconst verifyURL = `https://www.google.com/recaptcha/api/siteverify?secret=${process.env.RECAPTCHA_SECRET_KEY}&response=${recaptchaResponse}`;\r\n\r\n\ttry {\r\n\t\tconst response = await fetch(verifyURL, { method: 'POST' });\r\n\t\tconst data = await response.json() as RecaptchaResponse; // Not strict\r\n\r\n\t\tif (!data.success) {\r\n\t\t\t\treturn res.status(400).send('reCAPTCHA verification failed');\r\n\t\t}\r\n\r\n\t\tconst emailResult = await sendEmail({\r\n\t\t\tfrom: email,\r\n\t\t\tto: process.env.RECEIVER_EMAIL_SALES!,\r\n\t\t\tsubject: \"Sales Demo Request\",\r\n\t\t\ttext: `Name: ${name}\\nEmail: ${email}\\nPhone Number: ${phoneNumber}\\nCompany URL: ${companyUrl}\\nMessage: \\n${message}`\r\n\t\t});\r\n\r\n\t\tif (emailResult.success) {\r\n\t\t\tres.send(emailResult.message);\r\n\t\t} else {\r\n\t\t\tres.status(500).send(emailResult.message);\r\n\t\t}\r\n\t} catch (error) {\r\n\t\tconsole.error('Failed to submit form:', error);\r\n\t\tres.status(500).send('Server error');\r\n\t}\r\n});\r\n\r\nexport default router;"],"names":["Router","sendEmail","fetch","router","post","req","res","recaptchaResponse","name","email","phoneNumber","companyUrl","message","body","verifyURL","process","env","RECAPTCHA_SECRET_KEY","response","method","data","json","success","status","send","emailResult","from","to","RECEIVER_EMAIL_SALES","subject","text","error","console"],"mappings":"AAAA,SAASA,MAAM,QAAQ,UAAU;AACjC,SAASC,SAAS,QAAQ,8BAA8B;AACxD,OAAOC,WAAW,aAAa;AAG/B,MAAMC,SAASH;AAEf,kCAAkC;AAClCG,OAAOC,IAAI,CAAC,KAAK,OAAOC,KAAKC;IAC5B,MAAM,EAAEC,iBAAiB,EAAEC,IAAI,EAAEC,KAAK,EAAEC,WAAW,EAAEC,UAAU,EAAEC,OAAO,EAAE,GAAGP,IAAIQ,IAAI;IAErF,6CAA6C;IAC7C,MAAMC,YAAY,CAAC,uDAAuD,EAAEC,QAAQC,GAAG,CAACC,oBAAoB,CAAC,UAAU,EAAEV,kBAAkB,CAAC;IAE5I,IAAI;QACH,MAAMW,WAAW,MAAMhB,MAAMY,WAAW;YAAEK,QAAQ;QAAO;QACzD,MAAMC,OAAO,MAAMF,SAASG,IAAI,IAAyB,aAAa;QAEtE,IAAI,CAACD,KAAKE,OAAO,EAAE;YACjB,OAAOhB,IAAIiB,MAAM,CAAC,KAAKC,IAAI,CAAC;QAC9B;QAEA,MAAMC,cAAc,MAAMxB,UAAU;YACnCyB,MAAMjB;YACNkB,IAAIZ,QAAQC,GAAG,CAACY,oBAAoB;YACpCC,SAAS;YACTC,MAAM,CAAC,MAAM,EAAEtB,KAAK,SAAS,EAAEC,MAAM,gBAAgB,EAAEC,YAAY,eAAe,EAAEC,WAAW,aAAa,EAAEC,QAAQ,CAAC;QACxH;QAEA,IAAIa,YAAYH,OAAO,EAAE;YACxBhB,IAAIkB,IAAI,CAACC,YAAYb,OAAO;QAC7B,OAAO;YACNN,IAAIiB,MAAM,CAAC,KAAKC,IAAI,CAACC,YAAYb,OAAO;QACzC;IACD,EAAE,OAAOmB,OAAO;QACfC,QAAQD,KAAK,CAAC,0BAA0BA;QACxCzB,IAAIiB,MAAM,CAAC,KAAKC,IAAI,CAAC;IACtB;AACD;AAEA,eAAerB,OAAO"}